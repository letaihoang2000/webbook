<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>My Books - BookSaw</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="_csrf" th:content="${_csrf.token}" content=""/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}" content=""/>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/normalize.css}">
    <link rel="stylesheet" th:href="@{/icomoon/icomoon.css}">
    <link rel="stylesheet" th:href="@{/css/vendor.css}">
    <link rel="stylesheet" th:href="@{/css/customer/home.css}">
    <link rel="stylesheet" th:href="@{/css/customer/navbar.css}">
    <link rel="stylesheet" th:href="@{/css/customer/navbar-badges.css}">
    <link rel="stylesheet" th:href="@{/css/customer/all_books.css}">
    <link rel="stylesheet" th:href="@{/css/customer/purchased-books.css}">
    <link rel="stylesheet" th:href="@{/css/customer/wishlist.css}">
    <link rel="stylesheet" th:href="@{/css/customer/toast-notifications.css}">
</head>

<body>

<!-- Include Navbar Fragment -->
<div th:replace="~{fragments/customer_navbar :: navbar}"></div>

<!-- Success Modal on My Books Page -->
<div class="modal fade" id="purchaseSuccessModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0 shadow-lg">
            <div class="modal-body text-center p-5">
                <div class="success-animation mb-4">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="100" height="100" fill="#28a745">
                        <path d="M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM369 209L241 337c-9.4 9.4-24.6 9.4-33.9 0l-64-64c-9.4-9.4-9.4-24.6 0-33.9s24.6-9.4 33.9 0l47 47L335 175c9.4-9.4 24.6-9.4 33.9 0s9.4 24.6 0 33.9z"/>
                    </svg>
                </div>
                <h2 class="text-success mb-3">Welcome to Your Library!</h2>
                <p class="text-muted mb-4">Your books are now available to read.</p>
                <div class="order-details bg-light rounded p-3 mb-4">
                    <div class="d-flex justify-content-between mb-2">
                        <span class="fw-semibold">Order ID:</span>
                        <span class="text-primary" th:text="${orderId}">-</span>
                    </div>
                    <div class="d-flex justify-content-between">
                        <span class="fw-semibold">Total:</span>
                        <span class="text-success fw-bold">$<span th:text="${#numbers.formatDecimal(orderAmount, 1, 2)}">0.00</span></span>
                    </div>
                </div>
                <button type="button" class="btn btn-success btn-lg w-100" data-bs-dismiss="modal">
                    Start Reading
                </button>
            </div>
        </div>
    </div>
</div>

<style>
    .success-animation {
        animation: scaleIn 0.5s ease-in-out;
    }
    @keyframes scaleIn {
        0% { transform: scale(0); opacity: 0; }
        50% { transform: scale(1.1); }
        100% { transform: scale(1); opacity: 1; }
    }

    /* My Books Grid Styles - matching all_books */
    #my-books-grid .product-style {
        position: relative;
        overflow: hidden;
        margin-bottom: 20px;
        border-radius: 8px;
    }

    #my-books-grid .product-style img {
        width: 100%;
        height: 400px;
        object-fit: cover;
        transition: transform 0.5s ease;
    }

    #my-books-grid .product-style:hover img {
        transform: scale(1.05);
    }

    #my-books-grid figcaption {
        text-align: center;
    }

    #my-books-grid .item-category {
        display: inline-block;
        padding: 5px 15px;
        background: #f5f5f5;
        color: #777;
        font-size: 0.85rem;
        border-radius: 15px;
        margin-bottom: 10px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    #my-books-grid .item-title {
        font-size: 1.1rem;
        font-weight: 600;
        color: #333;
        margin: 10px 0;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
        min-height: 2.6em;
    }

    #my-books-grid .item-title a {
        color: #333;
        text-decoration: none;
        transition: color 0.3s;
    }

    #my-books-grid .item-title a:hover {
        color: #9c8e6e;
    }

    #my-books-grid .item-author {
        display: block;
        color: #777;
        font-size: 0.95rem;
        margin-bottom: 10px;
        font-style: italic;
    }

    /* Read button specific style for my_books */
    .read-btn {
        background: linear-gradient(135deg, #28a745 0%, #20c997 100%) !important;
    }

    .read-btn:hover {
        background: linear-gradient(135deg, #20c997 0%, #28a745 100%) !important;
        transform: translateY(-3px);
        box-shadow: 0 6px 20px rgba(40, 167, 69, 0.6) !important;
    }

    /* View Details button */
    .view-details-btn {
        background: rgba(52, 152, 219, 0.95) !important;
    }

    .view-details-btn:hover {
        background: #2980b9 !important;
        transform: translateY(-3px);
        box-shadow: 0 6px 20px rgba(41, 128, 185, 0.6) !important;
    }
</style>

<!-- Page Header -->
<section id="my-books-header" class="py-5" style="background: #f9f9f9;">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <div class="section-header align-center">
                    <div class="title">
                        <span>Your Library</span>
                    </div>
                    <h2 class="section-title">My Books</h2>
                    <p class="results-info" th:if="${!purchasedBooks.isEmpty()}">
                        You own <strong th:text="${purchasedBooks.size()}">0</strong>
                        <span th:text="${purchasedBooks.size() == 1} ? 'book' : 'books'">books</span>
                    </p>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- My Books Grid -->
<section id="my-books-grid" class="bookshelf py-5 my-5" style="background: #f9f9f9;">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <!-- Books Grid -->
                <div class="product-list" th:if="${!purchasedBooks.isEmpty()}">
                    <div class="row">
                        <div class="col-md-3 col-sm-6 mb-4" th:each="book : ${purchasedBooks}">
                            <div class="product-item">
                                <figure class="product-style">
                                    <img th:src="${book.image}"
                                         th:alt="${book.title}"
                                         class="product-item">

                                    <!-- Action Icons Overlay - Same style as all_books -->
                                    <div class="product-actions">
                                        <!-- View Details Button -->
                                        <a th:href="@{/customer/book/{id}(id=${book.id})}"
                                           class="action-btn view-btn"
                                           title="View Details">
                                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512">
                                                <path d="M288 80c-65.2 0-118.8 29.6-159.9 67.7C89.6 183.5 63 226 49.4 256c13.6 30 40.2 72.5 78.6 108.3C169.2 402.4 222.8 432 288 432s118.8-29.6 159.9-67.7C486.4 328.5 513 286 526.6 256c-13.6-30-40.2-72.5-78.6-108.3C406.8 109.6 353.2 80 288 80zM95.4 112.6C142.5 68.8 207.2 32 288 32s145.5 36.8 192.6 80.6c46.8 43.5 78.1 95.4 93 131.1c3.3 7.9 3.3 16.7 0 24.6c-14.9 35.7-46.2 87.7-93 131.1C433.5 443.2 368.8 480 288 480s-145.5-36.8-192.6-80.6C48.6 356 17.3 304 2.5 268.3c-3.3-7.9-3.3-16.7 0-24.6C17.3 208 48.6 156 95.4 112.6zM288 336c44.2 0 80-35.8 80-80s-35.8-80-80-80c-.7 0-1.3 0-2 0c1.3 5.1 2 10.5 2 16c0 35.3-28.7 64-64 64c-5.5 0-10.9-.7-16-2c0 .7 0 1.3 0 2c0 44.2 35.8 80 80 80zm0-208a128 128 0 1 1 0 256 128 128 0 1 1 0-256z"/>
                                            </svg>
                                        </a>

                                        <!-- Read Book Button -->
                                        <a th:href="@{/customer/read/{id}(id=${book.id})}"
                                           class="action-btn read-btn"
                                           title="Read Book">
                                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512">
                                                <path d="M249.6 471.5c10.8 3.8 22.4-4.1 22.4-15.5V78.6c0-4.2-1.6-8.4-5-11C247.4 52 202.4 32 144 32C93.5 32 46.3 45.3 18.1 56.1C6.8 60.5 0 71.7 0 83.8V454.1c0 11.9 12.8 20.2 24.1 16.5C55.6 460.1 105.5 448 144 448c33.9 0 79 14 105.6 23.5zm76.8 0C353 462 398.1 448 432 448c38.5 0 88.4 12.1 119.9 22.6c11.3 3.8 24.1-4.6 24.1-16.5V83.8c0-12.1-6.8-23.3-18.1-27.6C529.7 45.3 482.5 32 432 32c-58.4 0-103.4 20-123 35.6c-3.3 2.6-5 6.8-5 11V456c0 11.4 11.7 19.3 22.4 15.5z"/>
                                            </svg>
                                        </a>

                                        <!-- Wishlist Button -->
                                        <button type="button"
                                                class="action-btn wishlist-btn"
                                                th:classappend="${wishlistBookIds != null && wishlistBookIds.contains(book.id.toString())} ? 'in-wishlist' : ''"
                                                th:attr="data-book-id=${book.id}"
                                                th:title="${wishlistBookIds != null && wishlistBookIds.contains(book.id.toString())} ? 'Remove from Wishlist' : 'Add to Wishlist'">
                                            <!-- Heart Icon (shown when NOT in wishlist) -->
                                            <svg th:if="${wishlistBookIds == null || !wishlistBookIds.contains(book.id.toString())}"
                                                 xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="heart-icon">
                                                <path d="M47.6 300.4L228.3 469.1c7.5 7 17.4 10.9 27.7 10.9s20.2-3.9 27.7-10.9L464.4 300.4c30.4-28.3 47.6-68 47.6-109.5v-5.8c0-69.9-50.5-129.5-119.4-141C347 36.5 300.6 51.4 268 84L256 96 244 84c-32.6-32.6-79-47.5-124.6-39.9C50.5 55.6 0 115.2 0 185.1v5.8c0 41.5 17.2 81.2 47.6 109.5z"/>
                                            </svg>
                                            <!-- X Icon (shown when IN wishlist) -->
                                            <svg th:if="${wishlistBookIds != null && wishlistBookIds.contains(book.id.toString())}"
                                                 xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512" class="x-icon">
                                                <path d="M342.6 150.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L192 210.7 86.6 105.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L146.7 256 41.4 361.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L192 301.3 297.4 406.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L237.3 256 342.6 150.6z"/>
                                            </svg>
                                        </button>
                                    </div>
                                </figure>
                                <figcaption>
                                    <div class="item-category" th:text="${book.category?.name}">Category</div>
                                    <h3 class="item-title">
                                        <a th:href="@{/customer/read/{id}(id=${book.id})}"
                                           th:text="${book.title}">Book Title</a>
                                    </h3>
                                    <span class="item-author" th:text="${book.author?.name}">Author Name</span>
                                    <div class="item-status text-success">
                                        <i class="icon icon-check-circle"></i> Purchased
                                    </div>
                                </figcaption>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Empty State -->
                <div class="empty-library text-center py-5" th:if="${purchasedBooks.isEmpty()}">
                    <i class="icon icon-book" style="font-size: 5rem; color: #ccc;"></i>
                    <h3 class="mt-4">Your library is empty</h3>
                    <p class="text-muted mb-4">Start building your digital library today!</p>
                    <a th:href="@{/customer/all-books}" class="btn btn-accent btn-lg">
                        <i class="icon icon-search"></i> Browse Books
                    </a>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Footer -->
<footer id="footer">
    <div class="container">
        <div class="row">
            <div class="col-md-12 text-center">
                <p>Â© 2024 BookSaw. All rights reserved.</p>
            </div>
        </div>
    </div>
</footer>

<div th:replace="~{modals/customer/signout :: logoutModal}"></div>

<script th:src="@{/js/jquery-1.11.0.min.js}"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>
<script th:src="@{/js/plugins.js}"></script>
<script th:src="@{/js/script.js}"></script>
<script th:src="@{/js/customer/signout.js}"></script>
<script th:src="@{/js/customer/wishlist.js}"></script>

<script>
    // Show modal if payment success
    $(document).ready(function() {
        const paymentStatus = '[[${paymentStatus}]]';
        if (paymentStatus === 'success') {
            $('#purchaseSuccessModal').modal('show');
        }
    });
</script>

</body>
</html>