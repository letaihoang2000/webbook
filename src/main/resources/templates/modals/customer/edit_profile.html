<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
</head>
<body>
<!-- Edit Profile Modal -->
<div th:fragment="editProfileModal">
    <div class="modal fade" id="editProfileModal" tabindex="-1" aria-labelledby="editProfileModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editProfileModalLabel">
                        <i class="icon icon-pencil"></i> Edit Profile
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- Alert Messages -->
                    <div id="profileAlert" class="alert alert-dismissible fade" role="alert" style="display: none;">
                        <span id="profileAlertMessage"></span>
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>

                    <form id="editProfileForm" enctype="multipart/form-data">
                        <input type="hidden" name="id" id="editUserId">

                        <!-- Profile Image Upload -->
                        <div class="mb-3 text-center">
                            <div class="avatar-upload-container">
                                <img id="editAvatarPreview"
                                     src=""
                                     alt="Profile Picture"
                                     class="edit-avatar-preview">
                                <label for="editImageFile" class="avatar-upload-label">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-upload" viewBox="0 0 16 16">
                                        <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5"/>
                                        <path d="M7.646 1.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 2.707V11.5a.5.5 0 0 1-1 0V2.707L5.354 4.854a.5.5 0 1 1-.708-.708z"/>
                                    </svg>
                                    <span>Change Photo</span>
                                </label>
                                <input type="file"
                                       class="d-none"
                                       id="editImageFile"
                                       name="imageFile"
                                       accept="image/*">
                            </div>
                            <small class="form-text text-muted d-block mt-2">
                                Accepted formats: JPG, PNG, GIF (Max 5MB)
                            </small>
                        </div>

                        <div class="row">
                            <!-- First Name -->
                            <div class="col-md-6 mb-3">
                                <label for="editFirstName" class="form-label">
                                    <i class="icon icon-user"></i> First Name <span class="text-danger">*</span>
                                </label>
                                <input type="text"
                                       class="form-control"
                                       id="editFirstName"
                                       name="first_name"
                                       required>
                            </div>

                            <!-- Last Name -->
                            <div class="col-md-6 mb-3">
                                <label for="editLastName" class="form-label">
                                    <i class="icon icon-user"></i> Last Name <span class="text-danger">*</span>
                                </label>
                                <input type="text"
                                       class="form-control"
                                       id="editLastName"
                                       name="last_name"
                                       required>
                            </div>
                        </div>

                        <!-- Email (Read-only) -->
                        <div class="mb-3">
                            <label for="editEmail" class="form-label">
                                <i class="icon icon-envelope"></i> Email
                            </label>
                            <input type="email"
                                   class="form-control"
                                   id="editEmail"
                                   readonly
                                   disabled>
                            <small class="form-text text-muted">Email cannot be changed</small>
                        </div>

                        <!-- Mobile -->
                        <div class="mb-3">
                            <label for="editMobile" class="form-label">
                                <i class="icon icon-phone"></i> Mobile
                            </label>
                            <input type="text"
                                   class="form-control"
                                   id="editMobile"
                                   name="mobile">
                        </div>

                        <!-- Address -->
                        <div class="mb-3">
                            <label for="editAddress" class="form-label">
                                <i class="icon icon-location"></i> Address
                            </label>
                            <textarea class="form-control"
                                      id="editAddress"
                                      name="address"
                                      rows="3"></textarea>
                        </div>

                        <!-- Password Change Section -->
                        <div class="password-change-section">
                            <hr class="my-4">
                            <h6 class="mb-3">
                                <i class="icon icon-lock"></i> Change Password
                                <small class="text-muted">(Optional - leave blank to keep current password)</small>
                            </h6>

                            <!-- Current Password (Always visible) -->
                            <div class="mb-3">
                                <label for="editCurrentPassword" class="form-label">
                                    <i class="icon icon-lock"></i> Current Password
                                </label>
                                <div class="password-input-wrapper">
                                    <input type="password"
                                           class="form-control"
                                           id="editCurrentPassword"
                                           name="currentPassword"
                                           placeholder="Enter your current password">
                                </div>
                                <small class="form-text text-danger" id="currentPasswordError" style="display: none;">
                                    <i class="icon icon-close"></i> Current password is incorrect
                                </small>
                            </div>

                            <div class="row">
                                <!-- New Password -->
                                <div class="col-md-6 mb-3">
                                    <label for="editPassword" class="form-label">
                                        <i class="icon icon-lock"></i> New Password
                                    </label>
                                    <div class="password-input-wrapper">
                                        <input type="password"
                                               class="form-control"
                                               id="editPassword"
                                               name="password"
                                               placeholder="Enter new password">
                                        <button type="button" class="toggle-password" data-target="editPassword" id="show-new-pass">
                                            <svg id="new-eye" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-eye" viewBox="0 0 16 16">
                                                <path d="M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8M1.173 8a13 13 0 0 1 1.66-2.043C4.12 4.668 5.88 3.5 8 3.5s3.879 1.168 5.168 2.457A13 13 0 0 1 14.828 8q-.086.13-.195.288c-.335.48-.83 1.12-1.465 1.755C11.879 11.332 10.119 12.5 8 12.5s-3.879-1.168-5.168-2.457A13 13 0 0 1 1.172 8z"/>
                                                <path d="M8 5.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5M4.5 8a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0"/>
                                            </svg>
                                        </button>
                                    </div>
                                    <!-- Password Strength Indicator -->
                                    <div class="password-strength mt-2" id="passwordStrength" style="display: none;">
                                        <div class="password-strength-bar"></div>
                                    </div>
                                    <small class="form-text text-muted" id="passwordRequirements">
                                        Must contain: 8+ characters, uppercase, lowercase, number, and special character
                                    </small>
                                </div>

                                <!-- Confirm New Password -->
                                <div class="col-md-6 mb-3">
                                    <label for="editConfirmPassword" class="form-label">
                                        <i class="icon icon-lock"></i> Confirm New Password
                                    </label>
                                    <div class="password-input-wrapper">
                                        <input type="password"
                                               class="form-control"
                                               id="editConfirmPassword"
                                               placeholder="Confirm new password">
                                        <button type="button" class="toggle-password" id="show-confirm-pass" data-target="editConfirmPassword">
                                            <svg id="confirm-eye" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-eye" viewBox="0 0 16 16">
                                                <path d="M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8M1.173 8a13 13 0 0 1 1.66-2.043C4.12 4.668 5.88 3.5 8 3.5s3.879 1.168 5.168 2.457A13 13 0 0 1 14.828 8q-.086.13-.195.288c-.335.48-.83 1.12-1.465 1.755C11.879 11.332 10.119 12.5 8 12.5s-3.879-1.168-5.168-2.457A13 13 0 0 1 1.172 8z"/>
                                                <path d="M8 5.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5M4.5 8a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0"/>
                                            </svg>
                                        </button>
                                    </div>
                                    <small class="password-match-feedback" style="display: none;"></small>
                                </div>
                            </div>
                        </div>

                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="icon icon-close"></i> Cancel
                    </button>
                    <button type="button" class="btn btn-accent" id="saveProfileBtn">
                        <span class="btn-text">
                            <i class="icon icon-check"></i> Save Changes
                        </span>
                        <span class="btn-loading" style="display: none;">
                            <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
                            Saving...
                        </span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
</html>